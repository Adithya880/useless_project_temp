<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Breakup Predictor</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  
  <style>
    body {
      background-color: #ffe6f0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    h1 {
      font-style: italic;
      font-weight: 800;
      color: #c2185b;
    }
    #result {
      white-space: pre-wrap;
    }
    html {
      scroll-behavior: smooth;
    }
  </style>
</head>
<body>
  <div class="container my-5">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10 col-sm-12 text-center">
        <h1 class="mb-4">üíî Breakup Predictor</h1>

        <!-- Upload Section -->
        <div class="card mb-4 shadow-sm">
          <div class="card-body">
            <h4 class="card-title">Upload Image</h4>
            <form id="imgForm">
              <input type="file" class="form-control mb-3" id="image" name="image" accept="image/*" />
              <button type="submit" class="btn btn-danger">Upload & Predict</button>
            </form>
          </div>
        </div>

        <!-- Text Input Section -->
        <div class="card mb-4 shadow-sm">
          <div class="card-body">
            <h4 class="card-title">Or Enter Text</h4>
            <textarea id="text" class="form-control mb-3" rows="5" placeholder="Paste the convo here..."></textarea>
            <button id="txtBtn" class="btn btn-danger">Send Text</button>
          </div>
        </div>


        <!-- Result Section -->
        <div id="resultCard" class="card shadow-sm">
          <div class="card-body">
            <h4 class="card-title">Prediction Result</h4>
            <pre id="result" class="bg-light p-3 rounded border">No prediction yet</pre>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- JS Logic -->
  <script>
    // Scroll to result card
    function scrollToResult() {
      document.getElementById("resultCard").scrollIntoView({ behavior: "smooth" });
    }

    document.getElementById("imgForm").addEventListener("submit", async e => {
      e.preventDefault();
      const file = document.getElementById("image").files[0];
      if (!file) return alert("Pick a file!");
      const fd = new FormData();
      fd.append("image", file);
      const res = await fetch("/api/predict", { method: "POST", body: fd });
      const json = await res.json();
      document.getElementById("result").innerText = formatResponse(json);
      scrollToResult(); // Auto-scroll after image prediction
    });

    document.getElementById("txtBtn").addEventListener("click", async () => {
      const text = document.getElementById("text").value;
      if (!text) return alert("Type something!");
      const res = await fetch("/api/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text })
      });
      const json = await res.json();
      document.getElementById("result").innerText = formatResponse(json);
      scrollToResult(); // Auto-scroll after text prediction
    });

    function formatResponse(data) {
      return `üíî Score: ${data.score}
üö© Danger Rating: ${data.danger_rating}
üóØ Sarcastic Reply: ${data.reply}
üîç Flipped Insights:
- ${data.flipped_insights.join("\n- ")}`;
    }

    // Ensure page loads from top
    if ('scrollRestoration' in history) {
      history.scrollRestoration = 'manual';
    }
    window.onbeforeunload = function () {
      window.scrollTo(0, 0);
    };
  </script>
</body>
</html>